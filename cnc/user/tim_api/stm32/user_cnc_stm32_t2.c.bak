/*
*********************************************************************************************************
*
*	模块名称 : stm32_t2定时器驱动
*	文件名称 : user_cnc_stm32_t2.c
*	版    本 : V1.0
*	说    明 : stm32_t2的定时器驱动
*
*	修改记录 :
*		版本号  日期        作者     说明
*		V1.0    2016-12-15  lcj      开写
*
*	Copyright (C), 2016-2017, lcj1031@foxmail.com
*
*********************************************************************************************************
*/
#include "cncinit.h"

void stm32_t2_init(uint32_t arr);
void stm32_t2_open(void);
void stm32_t2_close(void);
void stm32_t2_updata(uint32_t arr);

cnc_tim_api_typedef stm32_tim2=
{
	stm32_t2_init,
	stm32_t2_open,
	stm32_t2_close,
	stm32_t2_updata,
};

/*
*********************************************************************************************************
*	函 数 名: stm32_t2_init
*	功能说明: stm32定时器2的初始化
*	形    参: 无
*	返 回 值: 无
*********************************************************************************************************
*/
void stm32_t2_init(uint32_t arr)
{
	TIM2_init(arr);
}	

/*
*********************************************************************************************************
*	函 数 名: stm32_t2_open
*	功能说明: 开stm32定时器2
*	形    参: 无
*	返 回 值: 无
*********************************************************************************************************
*/
void stm32_t2_open(void)
{
	CNC_XENL;CNC_YENL;CNC_ZENL;CNC_AENL;
	CNC_XCPH;CNC_YCPH;
 TIM_Cmd(TIM2, ENABLE);
 TIM_ITConfig(TIM2,TIM_IT_CC1, ENABLE );
 TIM_ITConfig(TIM2,TIM_IT_Update , ENABLE );
 TIM2->SR=0x0000;
}

/*
*********************************************************************************************************
*	函 数 名: stm32_t2_close
*	功能说明: 关stm32定时器2
*	形    参: 无
*	返 回 值: 无
*********************************************************************************************************
*/
void stm32_t2_close(void)
{
	CNC_XENH;CNC_YENH;CNC_ZENH;CNC_AENH;
	CNC_XCPH;CNC_YCPH;
 TIM_Cmd(TIM2, DISABLE);
 TIM_ITConfig(TIM2,TIM_IT_CC1,DISABLE);
 TIM_ITConfig(TIM2,TIM_IT_Update ,DISABLE);
 TIM2->SR=0x0000; 
}

/*
*********************************************************************************************************
*	函 数 名: stm32_t2_updata
*	功能说明: 更新定时器值
*	形    参: 无
*	返 回 值: 无
*********************************************************************************************************
*/
void stm32_t2_updata(uint32_t arr)
{
	TIM2->CCR1=(arr>>1);
 TIM2->ARR=arr;
}	

/***************************** lcj1031@foxmail.com (END OF FILE) *********************************/
